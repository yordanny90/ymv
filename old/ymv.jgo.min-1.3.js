/*
 * JavaScript Get Object
 * ymv.jgo v1.3
 * Fecha: 20161125
 * Autor: Yordanny Mej√≠as V. yordanny90@gmail.com
 */
$jgo=function(a,b){return b=function(c,d,e){if(!c||"string"!=typeof c&&"object"!=typeof c||"object"==typeof c&&!c.ambit)throw new Error("Ambit missing");return"object"!=typeof $jgo_ambit&&($jgo_ambit={}),1==arguments.length&&"string"==typeof c&&$jgo_ambit[c]?$jgo_ambit[c]:this.constructor!=b?new b(c,d,e):("string"==typeof d&&(d={url:d}),this.cfg=$joq(b.default_cfg).select().merge(d).val(),"string"==typeof c&&(c={ambit:c}),this.opts=$joq(b.default_opts).select().update(c).val(),this.opts.root=a(this.opts.root?this.opts.root:document),this.attrs={},this.attrsdom={},void(e&&($jgo_ambit["string"==typeof e?e:this.opts.ambit]=this)))},b.default_opts={dom:"jgo",ambit:"",root:!1,validate:!1,validFilter:function(b,c){return a(c).is(":valid,[type=hidden]")},enabledFilter:":enabled"},b.default_cfg={method:"POST",processData:!1,contentType:!1,url:window.location.href,beforeSend:function(a,b){b.jgo.node("beforesend",!0).execAttr(b.jgo.attr("beforesend"),"jgo,xhr,cfg",b.jgo,a,b),a.jgo=b.jgo,a.responseFields=b.responseFields},complete:function(a,b){var c=a.jgo;a.JSON=a[a.responseFields.json],a.TEXT=a[a.responseFields.text],a.XML=a[a.responseFields.xml],c.node(b).execAttr(c.attr(b),"jgo,xhr,status",c,a,b),"success"==b&&("undefined"!=typeof a.JSON?(c.node("onjson").execAttr(c.attr("onjson"),"jgo,json,xhr,status",c,a.JSON,a,b),c.setJSON(a.JSON)):"undefined"!=typeof a.XML?(c.node("onxml").execAttr(c.attr("onxml"),"jgo,xml,xhr,status",c,a.XML,a,b),c.setXML(a.XML)):"undefined"!=typeof a.TEXT&&(c.node("ontext").execAttr(c.attr("ontext"),"jgo,text,xhr,status",c,a.TEXT,a,b),c.setTEXT(a.TEXT))),c.node("complete",!0).execAttr(c.attr("complete"),"jgo,xhr,status",c,a,b)}},b.jsonNodes={for:{fn:function(b,c,d){var e=a(this),f=$joq(c).get(e.attr(d));if("undefined"!=typeof f){if(e.is("["+b.attr("clear_for")+"]")&&e.html(""),e.is("["+b.attr("beforeset_for")+"]")){var g=e.execAttr(b.attr("beforeset_for"),"jgo,json,value",b,c,f)[0];"undefined"!=typeof g&&(f=g)}var h=b.attr("each");a.each(f,function(a,d){e.append(e.execAttr(h,"jgo,json,value,index,item",b,c,f,a,d)[0])}),e.is("["+b.attr("onset_for")+"]")&&e.execAttr(b.attr("onset_for"),"jgo,json,value",b,c,f)}else e.is("["+b.attr("offset_for")+"]")&&e.execAttr(b.attr("offset_for"),"jgo,json",b,c)},noempty:!0},html:{fn:function(b,c,d){var e=a(this),f=$joq(c).get(e.attr(d));if("undefined"!=typeof f){if(e.is("["+b.attr("beforeset_html")+"]")){var g=e.execAttr(b.attr("beforeset_html"),"jgo,json,value",b,c,f)[0];"undefined"!=typeof g&&(f=g)}e.html(f),e.is("["+b.attr("onset_html")+"]")&&e.execAttr(b.attr("onset_html"),"jgo,json,value",b,c,f)}else e.is("["+b.attr("offset_html")+"]")&&e.execAttr(b.attr("offset_html"),"jgo,json",b,c)},noempty:!0},text:{fn:function(b,c,d){var e=a(this),f=$joq(c).get(e.attr(d));if("undefined"!=typeof f){if(e.is("["+b.attr("beforeset_text")+"]")){var g=e.execAttr(b.attr("beforeset_text"),"jgo,json,value",b,c,f)[0];"undefined"!=typeof g&&(f=g)}e.text(f),e.is("["+b.attr("onset_text")+"]")&&e.execAttr(b.attr("onset_text"),"jgo,json,value",b,c,f)}else e.is("["+b.attr("offset_text")+"]")&&e.execAttr(b.attr("offset_text"),"jgo,json",b,c)},noempty:!0},value:{fn:function(b,c,d){var e=a(this),f=$joq(c).get(e.attr(d));if(f&&(f=f.toString()),"undefined"!=typeof f){if(e.is("["+b.attr("beforeset_value")+"]")){var g=e.execAttr(b.attr("beforeset_value"),"jgo,json,value",b,c,f)[0];"undefined"!=typeof g&&(f=g)}e.val(f),e.is("["+b.attr("onset_value")+"]")&&e.execAttr(b.attr("onset_value"),"jgo,json,value",b,c,f)}else e.is("["+b.attr("offset_value")+"]")&&e.execAttr(b.attr("offset_value"),"jgo,json",b,c)},noempty:!0},check:{fn:function(b,c,d){var e=a(this),f=$joq(c).get(e.attr(d));if(f&&(f=f.toString()),"undefined"!=typeof f){if(e.is("["+b.attr("beforeset_check")+"]")){var g=e.execAttr(b.attr("beforeset_check"),"jgo,json,value",b,c,f)[0];"undefined"!=typeof g&&(f=g)}e[0].checked=f==e[0].value,e.is("["+b.attr("onset_check")+"]")&&e.execAttr(b.attr("onset_check"),"jgo,json,value",b,c,f)}else e.is("["+b.attr("offset_check")+"]")&&e.execAttr(b.attr("offset_check"),"jgo,json",b,c)},noempty:!0},attr:{fn:function(b,c,d){var e=a(this),f=e.attr(d),g=f.split("=",1)[0];if(f=f.substr(f.indexOf("=")+1),f=$joq(c).get(f),f&&(f=f.toString()),"undefined"!=typeof f){if(e.is("["+b.attr("beforeset_attr")+"]")){var h=e.execAttr(b.attr("beforeset_attr"),"jgo,json,value,attr",b,c,f,g)[0];"undefined"!=typeof h&&(f=h)}e.attr(g,f),e.is("["+b.attr("onset_attr")+"]")&&e.execAttr(b.attr("onset_attr"),"jgo,json,value,attr",b,c,f,g)}else e.is("["+b.attr("offset_attr")+"]")&&e.execAttr(b.attr("offset_attr"),"jgo,json,attr",b,c,g)},noempty:!0}},b.textNodes={innerdefault:{fn:function(b,c,d){a(this).html(a(this).attr(d))},noempty:!0},innertext:{fn:function(b,c,d){a(this).text(c)},noempty:!1},innerhtml:{fn:function(b,c,d){a(this).html(c)},noempty:!1},innervalue:{fn:function(b,c,d){a(this).val(c)},noempty:!1}},b.xmlNodes={},b.fn=b.prototype,b.fn.attrdom=function(a){return this.attrsdom[a]?this.attrsdom[a]:this.attrsdom[a]=this.opts.dom+"-"+a},b.fn.nodedom=function(b,c){return a("["+this.attrdom(b)+"]"+(c?"["+this.attrdom(b)+'!=""]':""))},b.fn.attr=function(a){return this.attrs[a]?this.attrs[a]:this.attrs[a]=this.opts.dom+"-"+this.opts.ambit+"-"+a},b.fn.node=function(b,c){return a("["+this.attr(b)+"]"+(c?"["+this.attr(b)+'!=""]':""),this.opts.root)},b.fn.getDomInputs=function(a){return a?this.getDomInputs().filter(this.opts.validFilter):this.nodedom("name").filter('[name][name!=""]:not(['+this.attr("name")+"])").filter(this.opts.enabledFilter)},b.fn.getInputs=function(a){return a?this.getInputs().filter(this.opts.validFilter):this.node("name").add(this.node("form").find('[name][name!=""]')).filter('[name][name!=""]').filter(this.opts.enabledFilter)},b.fn.setJSON=function(c){if(c&&"object"==typeof c){var d=this;d.node("beginjson",!0).execAttr(d.attr("beginjson"),"jgo,json",d,c),a.each(b.jsonNodes,function(a,b){"function"==typeof b.fn&&d.node(a,b.noempty).execJs(b.fn,d,c,d.attr(a))}),d.node("endjson",!0).execAttr(d.attr("endjson"),"jgo,json",d,c)}},b.fn.setXML=function(c){if(c&&"object"==typeof c){var d=this;d.node("beginxml",!0).execAttr(d.attr("beginxml"),"jgo,xml",d,c),a.each(b.xmlNodes,function(a,b){"function"==typeof b.fn&&d.node(a,b.noempty).execJs(b.fn,d,c,d.attr(a))}),d.node("endxml",!0).execAttr(d.attr("endxml"),"jgo,xml",d,c)}},b.fn.setTEXT=function(c){if("string"==typeof c){var d=this;d.node("begintext",!0).execAttr(d.attr("begintext"),"jgo,text",d,c),a.each(b.textNodes,function(a,b){"function"==typeof b.fn&&d.node(a,b.noempty).execJs(b.fn,d,c,d.attr(a))}),d.node("endtext",!0).execAttr(d.attr("endtext"),"jgo,text",d,c)}},b.fn.formData=function(b){var c=this;if(!b||b.processData===!1&&b.contentType===!1)var d=new FormData,e=function(a,b){d.append(a,b)},f=function(b,c){c.files&&"object"==typeof c.files&&c.files.constructor==FileList?a.each(c.files,function(a,c){e(b,c)}):a(c).serialize()&&e(b,c.value)};else var d=[],e=function(a,b){d.push({name:a,value:b})},f=function(b,c){a(c).serialize()&&e(b,c.value)};if(b&&b.data)if("object"==typeof b.data&&b.data.constructor==FormData)for(var h,g=b.data.entries();(h=g.next()).done===!1;)e(h.value[0],h.value[1]);else"object"==typeof b.data&&a.each($joq(b.data).select(null,null,function(a,b){return a[b]&&"object"==typeof a[b]&&"undefined"!=typeof a[b].name&&"undefined"!=typeof a[b].value}).val(),function(a,b){void 0!=b.name&&void 0!=b.value&&e(b.name,b.value)});return this.getInputs().each(function(b,d){var e=a(d).attr(c.attr("name"));e||(e=a(d).attr("name")),e&&f(e,d)}),this.getDomInputs().each(function(b,d){var e=a(d).attr(c.attrdom("name"));e||(e=a(d).attr("name")),e&&f(e,d)}),d},b.fn.go=function(){if(delete this.lastXHR,!this.opts.validate||"function"!=typeof this.opts.validate&&this.getInputs().length==this.getInputs(!0).length&&this.getDomInputs().length==this.getDomInputs(!0).length||"function"==typeof this.opts.validate&&this.opts.validate(this)){var b=$joq(this.cfg).select().val();b.data=this.formData(b),b.jgo=this,this.lastXHR=a.ajax(b)}return this},b.fn.cloneFor=function(a,c){return b($joq(this.opts).select().update({root:a}).val(),this.cfg,c)},b}(jQuery);
